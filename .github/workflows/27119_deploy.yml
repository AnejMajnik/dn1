name: 27119_deploy

# secrets iz githuba
env:
    DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
    DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
    REPONAME: ${{ secrets.REPO_NAME }}
     
# izvede se le, če se je 27119_test.yml izvedel uspešno
on:
  workflow_run:
    workflows: ["27119_test"]
    types:
      - completed

jobs:
    deploy:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repozitorija
          uses: actions/checkout@v4

        - name: Prijava v Docker
          run: |
            docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD

        - name: Trenutni čas
          id: datum
          run: echo "date=$(date +'%Y-%m-%d--%M-%S')" >> "$GITHUB_ENV"

        - name: Zgradi docker sliko
          run: |
            echo ${{ steps.datum.outputs.date }}
            echo "docker build . --file Dockerfile --tag $REPONAME:$date"
            docker build . --file Dockerfile --tag $REPONAME:$date

        - name: Potisni docker sliko
          run: |
            docker push $REPONAME:$date